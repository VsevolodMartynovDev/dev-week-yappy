<!DOCTYPE html>
<html lang="ru">
   <head>
      <meta charset="UTF-8" />
      <title>Главная | VideoSearch</title>
      <link rel="stylesheet" href="styles.css" />
      <link
         href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap"
         rel="stylesheet"
      />
   </head>
   <body>
      <header class="header">
         <nav>
            <a href="index.html" class="logo"
               ><img
                  class="logo"
                  src="https://yappy.media/images/logo-full.svg"
                  imgfield="img"
                  style="max-width: 110px; width: 110px"
                  alt=""
            /></a>
            <div class="nav-links">
               <a href="index.html">Главная</a>
               <a href="search.html">Поиск</a>
               <a href="upload.html" class="active">Добавить</a>
            </div>
         </nav>
      </header>

      <main class="search-main">
         <div class="search-container">
            <input
               type="text"
               id="searchInput"
               placeholder="Введите запрос..."
            />
            <div id="searchResults" class="results-dropdown"></div>
         </div>
      </main>

      <footer class="site-footer">
         <div class="footer-content">
            <p>
               Сделано в рамках хакатона от ИТМО <strong>Dew Week 2025</strong>
            </p>
            <div class="developers">
               <p><span>Команда: </span>overfitters</p>
            </div>
         </div>
      </footer>
      <script>
         // Тестовые данные (можно вынести в отдельный файл)
         const mockDatabase = {
            сигма: [
               "https://s3.ritm.media/hackaton-itmo/d4da7ce8-888c-4c42-b9a0-7552c65d58c7",
               "https://s3.ritm.media/hackaton-itmo/90efb422-0a19-4ad2-bfbb-e0a8d14be13b",
               "https://s3.ritm.media/hackaton-itmo/836e58c0-c586-4218-ba09-e96b155dd2d1",
               "https://s3.ritm.media/hackaton-itmo/777167d3-6201-4e25-a082-35a181c597de",
               "https://s3.ritm.media/hackaton-itmo/a3814660-bd11-4e3f-b8fa-7965b7d37951",
               "https://s3.ritm.media/hackaton-itmo/16323e18-6de3-4cb7-b68a-5338710fe7c3",
               "https://s3.ritm.media/hackaton-itmo/d9342ded-15f4-4783-ade7-70baf93b887e",
               "https://s3.ritm.media/hackaton-itmo/8891217d-988b-4b2c-9b17-fa74c67f5f05",
               "https://s3.ritm.media/hackaton-itmo/8f8fbfdc-64f3-49e0-b56c-a56f237a6628",
               "https://s3.ritm.media/hackaton-itmo/039ffdc8-9dd8-4500-974b-41c57c6e34de",
            ],
            альтушка: [
               "https://s3.ritm.media/hackaton-itmo/a3601f36-d206-480b-8e0b-8b026d410159",
               "https://s3.ritm.media/hackaton-itmo/879b13e7-fafd-43cf-801f-74ead0028b10",
               "https://s3.ritm.media/hackaton-itmo/89885711-2fb8-4f22-8c8f-7817a67ed4a3",
               "https://s3.ritm.media/hackaton-itmo/2f094284-9cd3-4eb3-a477-2d77aa7e1623",
               "https://s3.ritm.media/hackaton-itmo/97520518-7b74-484e-8c0a-ffb3b24c19e3",
               "https://s3.ritm.media/hackaton-itmo/0efec3d9-ed0d-4a4f-b61f-3c73985aca5d",
               "https://s3.ritm.media/hackaton-itmo/aee4871d-3123-44c1-a17b-a98a0530989d",
               "https://s3.ritm.media/hackaton-itmo/2eca3495-73ad-47c7-bfa6-1ae4e70b43ad",
               "https://s3.ritm.media/hackaton-itmo/e82d8b5f-c39d-4583-88dd-845e9631ec49",
               "https://s3.ritm.media/hackaton-itmo/8792f471-4ab7-4538-91e7-bb3b191ae26c",
            ],
            пикмэ: [
               "https://s3.ritm.media/hackaton-itmo/ea990550-6d53-49df-a776-70b19eab3926",
               "https://s3.ritm.media/hackaton-itmo/433a7da0-6c40-4e60-9426-1573f84569e2",
               "https://s3.ritm.media/hackaton-itmo/5fdd79e9-521a-4c94-a716-fd6460d46f81",
               "https://s3.ritm.media/hackaton-itmo/8cb5727c-dea5-497a-b61b-661964375308",
               "https://s3.ritm.media/hackaton-itmo/27193c69-2089-485a-b002-897ef20c993e",
               "https://s3.ritm.media/hackaton-itmo/94fe6f30-0e7e-4b87-8f78-8139bf35d7c2",
               "https://s3.ritm.media/hackaton-itmo/8aa7720d-57d6-43b0-a88b-1accac3d965f",
               "https://s3.ritm.media/hackaton-itmo/37203831-ffaf-4013-b5df-d2ddb82d7a8d",
               "https://s3.ritm.media/hackaton-itmo/684d448a-48f6-4294-9f66-8aa30b3cf359",
               "https://s3.ritm.media/hackaton-itmo/c8b4db34-cde4-41e2-831e-30a734a0775f",
            ],
            VIPERR: [
               "https://s3.ritm.media/hackaton-itmo/6db7fbf1-b9b6-467c-9fa6-edccbb3bff2c",
               "https://s3.ritm.media/hackaton-itmo/0a2a4e23-ae31-46d9-9c64-94d7d15341ef",
               "https://s3.ritm.media/hackaton-itmo/d9ae410f-6374-4138-b003-7ae7294c9b6d",
               "https://s3.ritm.media/hackaton-itmo/14ae533c-46ca-402e-a76f-abaf09673212",
               "https://s3.ritm.media/hackaton-itmo/dbd9f224-ff63-4682-a09b-1055f51b79f7",
               "https://s3.ritm.media/hackaton-itmo/7ba6908e-cdc1-4e76-b231-5f1de6581a61",
               "https://s3.ritm.media/hackaton-itmo/e69bdb0f-dc91-405e-aa00-a258d1a51b90",
               "https://s3.ritm.media/hackaton-itmo/e7215355-9611-4b3e-b375-2e73eb001fad",
               "https://s3.ritm.media/hackaton-itmo/2cb38630-06cb-4b55-b4ed-62cdc41bab48",
               "https://s3.ritm.media/hackaton-itmo/5e3d0e27-1e10-447a-ad60-d788aa566fe3",
            ],
         };
         // Режим работы (true - тестовые данные, false - реальный API)
         const USE_MOCK_DATA = false;

         function showEmptyState(message = "Начните вводить запрос") {
            const resultsContainer = document.getElementById("searchResults");
            resultsContainer.innerHTML = `
                <div class="empty-results">
                    <img src="https://yappy.media/images/search-nothing.svg" 
                         alt="Интересные видео уже в Yappy!" 
                         width="56" 
                         height="56">
                    <p>${message}</p>
                </div>
            `;
         }

         function renderResults(videoUrls) {
            const resultsContainer = document.getElementById("searchResults");
            if (videoUrls.length > 0) {
               resultsContainer.innerHTML = videoUrls
                  .map(
                     (url) => `
                    <div class="result-card">
                        <div class="video-preview" data-url="${url}"></div>
                        <h3>${url.split("/").slice(-2, -1)[0]}</h3>
                        <div class="video-url">${url}</div>
                    </div>
                `
                  )
                  .join("");
            } else {
               showEmptyState("Ничего не найдено");
            }
         }

         async function searchWithMock(query) {
            // Имитация задержки сети
            await new Promise((resolve) => setTimeout(resolve, 300));
            return mockDatabase[query.toLowerCase()] || [];
         }

         async function searchWithAPI(query) {
            try {
               const response = await fetch(
                  `http://localhost:8000/api/search?text=${encodeURIComponent(
                     query
                  )}`
               );
               return await response.json();
            } catch (error) {
               console.error("Ошибка поиска:", error);
               throw error;
            }
         }

         document.addEventListener("DOMContentLoaded", function () {
            showEmptyState();
         });

         document
            .getElementById("searchInput")
            .addEventListener("input", async function (e) {
               const query = e.target.value.trim();
               const resultsContainer =
                  document.getElementById("searchResults");

               if (!query) {
                  showEmptyState();
                  return;
               }

               try {
                  const videoUrls = USE_MOCK_DATA
                     ? await searchWithMock(query)
                     : await searchWithAPI(query);

                  renderResults(videoUrls);
               } catch (error) {
                  resultsContainer.innerHTML = `
                    <div class="error-state">
                        Ошибка соединения с сервером. Попробуйте позже.
                    </div>
                `;
               }
            });
      </script>
   </body>
</html>
